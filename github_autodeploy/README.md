# Github Autodeploy
Written in Python using FastAPI.
Written mainly to make deploying manually a yesterday's chore, but also to learn FastAPI.

# Configuration
`config.json` contains the actions you want to execute when a certain event happens in a repo
an example is available in the `config.json.example` file

It's schema can be generated by running `dump_config_schema.py` inside the `env` created by `start.sh`

# Installation
To start you can use the `start.sh` script. It creates a python environment and install the dependencies in it, then starts the server.

If you want to run this in the background you can use the `webhook-github-autodeploy.service` file and run it using systemd.

Before installing the service file you need to fill in the `User`, `WorkingDirectory` and `ReadWritePaths` lines.
This can be done automatically with the `service-smudge.sh` script, but you should check it before installation anyway.
You can try to revert the automatic fill by running the `service-clean.sh` but it can have it's problems (e.g. when you move the repository's directory).

Running as non-root is highly recommended.

# TODO:
- [X] Check if config.json is in a valid format and if working dir and script actually exist
- [X] Implement a QUEUE so repeated reqests don't collide
- [X] Add a log file
- [X] Write a better README
- [X] Implement a branch (ref) check
- [X] Add more comments
## One day
- [ ] Rewrite task_handler to be multithreaded instead of async
- [ ] (Is it really necessary?) Implement a timeout for repos to avoid spam
